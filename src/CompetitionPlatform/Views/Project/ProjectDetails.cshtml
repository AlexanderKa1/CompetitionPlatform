@using System.Threading.Tasks
@using CompetitionPlatform.Helpers
@using CompetitionPlatform.Models.ProjectViewModels
@model ProjectViewModel

@{
    ViewData["Title"] = "Project Details";
}

@{
    var createdDays = (DateTime.UtcNow - Model.Created).Days;
    var modifiedDays = (DateTime.UtcNow - Model.LastModified).Days;
    var createdDaysAgo = "";
    var modifiedDaysAgo = "";
    var projectUrl = Context.Request.Host + Context.Request.Path;
    var facebookSharingUrl = "https://www.facebook.com/sharer/sharer.php?u=" + projectUrl;
    var twitterSharingUrl = "https://twitter.com/share?url=" + projectUrl;
    var linkedinSharingUrl = "https://www.linkedin.com/cws/share?url=" + projectUrl;

    var fileExtension = "";
    if (Model.FileInfo != null)
    {
        fileExtension = Model.FileInfo.FileName.Split('.').Last();
    }

    if (createdDays == 0 || createdDays == 1)
    {
        createdDaysAgo = (createdDays == 0) ? "today" : "yesterday";
    }
    else
    {
        createdDaysAgo = " " + createdDays + " days ago";
    }

    if (modifiedDays == 0 || modifiedDays == 1)
    {
        modifiedDaysAgo = (modifiedDays == 0) ? "today" : "yesterday";
    }
    else
    {
        modifiedDaysAgo = " " + modifiedDays + " days ago";
    }

    var participantsCount = (!Model.ParticipantsPartial.Participants.Any()) ? "" : Model.ParticipantsPartial.Participants.Count().ToString();
    var commentsCount = (!Model.CommentsPartial.Comments.Any()) ? "" : Model.CommentsPartial.Comments.Count().ToString();
    var resultsCount = (!Model.ResultsPartial.Results.Any()) ? "" : Model.ResultsPartial.Results.Count().ToString();

    var checkCompetition = "";
    var checkSubmission = "";
    var checkVoting = "";

    var textCompetition = "";
    var textSubmission = "";
    var textVoting = "";

    switch (Model.Status)
    {
        case Status.Initiative:
            checkCompetition = "check--inprogress";
            checkSubmission = "check--inprogress";
            checkVoting = "check--inprogress";
            break;
        case Status.Registration:
            checkCompetition = "check--inprogress";
            checkSubmission = "check--inprogress";
            checkVoting = "check--inprogress";
            textCompetition = "text--green";
            break;
        case Status.Submission:
            checkCompetition = "check--green";
            checkSubmission = "check--inprogress";
            checkVoting = "check--inprogress";
            textSubmission = "text--red";
            break;
        case Status.Voting:
            checkCompetition = "check--green";
            checkSubmission = "check--red";
            checkVoting = "check--inprogress";
            textVoting = "text--yellow";
            break;
        case Status.Archive:
            checkCompetition = "check--green";
            checkSubmission = "check--red";
            checkVoting = "check--yellow";
            break;
    }
}

<section class="section section--lead section--padding">
    <div class="container container--extend">
        <div class="page__header">
            <div class="row">
                <div class="col-sm-8">
                    <h2>@Model.Name</h2>
                    <h3 class="page__subtitle mb0 project-details-category">@Model.Category</h3>
                </div>
                <div class="col-sm-4 text-right">
                    <a asp-area="" class="btn btn_edit btn-sm" asp-controller="Project" asp-action="Edit" asp-route-id="@Model.Id">Edit</a>
                </div>
            </div>
        </div>

        <div class="project_links">
            <div class="row">
                <div class="col-sm-7 project_links__share">
                    <div class="card__actions">
                        <a href="@twitterSharingUrl" class="action_link"><i class="icon icon--tw"></i> Tweet</a>
                        <a href="@facebookSharingUrl" class="action_link"><i class="icon icon--fb_simple"></i> Share</a>
                        <a href="@linkedinSharingUrl" class="action_link"><i class="icon icon--linkedin-icn"></i> Share</a>
                        <button type="button" class="action_link _copy_link" aria-label="Copied!" data-clipboard-text="@projectUrl"><i class="icon icon--link"></i> Copy link</button>
                    </div>
                </div>
                <div class="col-sm-5 project_links__actions">
                    <div class="card__actions text-right">
                        @if (!Model.IsFollowing)
                        {
                            <a asp-area="" asp-controller="ProjectDetails" asp-action="FollowProject" asp-route-id="@Model.Id" id="followButton" class="action_link action_follow">
                                <i class="icon icon--follow"></i>Follow
                            </a>
                        }
                        else
                        {
                            <a asp-area="" asp-controller="ProjectDetails" asp-action="UnFollowProject" asp-route-id="@Model.Id" id="followButton" class="action_link action_follow active">
                                <i class="icon icon--follow"></i>Unfollow
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-8 content__left">

                <div class="row prize_row">
                    <div class="col-xs-3">
                        <div class="prize">
                            <div class="prize__value">$@Model.BudgetFirstPlace</div>
                            <div class="prize__title">
                                1<sup>st</sup>Prize
                            </div>
                        </div>
                    </div>
                    @if (Model.BudgetSecondPlace != null)
                    {
                        <div class="col-xs-3">
                            <div class="prize">
                                <div class="prize__value">$@Model.BudgetSecondPlace</div>
                                <div class="prize__title">2<sup>nd</sup>Prize</div>
                            </div>
                        </div>
                        <div class="col-xs-3">
                            <div class="prize">
                                <div class="prize__value">$@Model.BudgetSecondPlace</div>
                                <div class="prize__title">3<sup>rd</sup>Prize</div>
                            </div>
                        </div>
                        <div class="col-xs-3">
                            <div class="prize">
                                <div class="prize__value">$@Model.BudgetSecondPlace</div>
                                <div class="prize__title">4<sup>th</sup>Prize</div>
                            </div>
                        </div>
                    }
                    @*<div class="col-xs-4">
                            <div class="icon_with_title">
                                <a href="">
                                    <img src="~/img/competition/wallet_icn.svg" width="55" alt="">
                                    <span>View Project's Wallet</span>
                                </a>
                            </div>
                        </div>*@
                </div>

                @await Html.PartialAsync("ProjectDetailsStatusBarPartial", Model.StatusBarPartial)

                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#info" aria-controls="info" role="tab" data-toggle="tab">Info</a></li>
                    <li role="presentation">
                        <a href="#Participants" aria-controls="participants" role="tab" data-toggle="tab">
                            Participants <sup>
                                @participantsCount
                            </sup>
                        </a>
                    </li>
                    <li role="presentation">
                        <a href="#Comments" aria-controls="comments" role="tab" data-toggle="tab">
                            Comments <sup>
                                @commentsCount
                            </sup>
                        </a>
                    </li>
                    <li role="presentation">
                        <a href="#Results" aria-controls="results" role="tab" data-toggle="tab">
                            Results <sup>
                                @resultsCount
                            </sup>
                        </a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="info">
                        <div class="text">
                            <div class="form-group">
                                <div class="row">
                                    <label asp-for="Overview" class="control-label col-sm-4"></label>
                                </div>
                                <p>
                                    @Model.Overview
                                </p>
                            </div>
                        </div>
                        <div class="text">
                            <div class="row">
                                <label class="control-label col-sm-4">Description</label>
                            </div>
                            @Html.Raw(Model.Description)
                        </div>
                        @if (Model.FileInfo != null)
            {
                            <div class="asset_link">
                                <div class="asset_link__icon">

                                    @switch (fileExtension.ToLower())
                                    {
                                        case "pdf":
                                            <div class="asset_icon asset_icon--red">PDF</div>
                                            break;
                                        case "xls":
                                        case "xlsx":
                                            <div class="asset_icon asset_icon--green">@fileExtension.ToUpper()</div>
                                            break;
                                        case "jpg":
                                            <div class="asset_icon asset_icon--yellow">JPG</div>
                                            break;
                                        case "doc":
                                        case "docx":
                                            <div class="asset_icon asset_icon--blue">@fileExtension.ToUpper()</div>
                                            break;
                                        default:
                                            <div class="asset_icon asset_icon--primary">@fileExtension.ToUpper()</div>
                                            break;
                                    }
                                </div>
                                <div class="asset_link__info">
                                    <div class="asset_link__title">
                                        <a asp-area="" asp-controller="ProjectDetails" asp-action="DownloadProjectFile" asp-route-id="@Model.Id">@Model.FileInfo.FileName</a>
                                    </div>
                                    @*<div class="asset_link__desc">24.8MB</div>*@
                                    <div class="">
                                        <a asp-area="" asp-controller="ProjectDetails" asp-action="DownloadProjectFile" asp-route-id="@Model.Id">Download</a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <div role="tabpanel" class="tab-pane" id="Participants">
                        @await Html.PartialAsync("ParticipantsPartial", Model.ParticipantsPartial)
                    </div>

                    <div role="tabpanel" class="tab-pane" id="Comments">
                        @await Html.PartialAsync("CommentsPartial", Model.CommentsPartial)
                    </div>

                    <div role="tabpanel" class="tab-pane" id="Results">
                        @await Html.PartialAsync("ResultsPartial", Model.ResultsPartial)
                    </div>
                </div>
            </div>

            <aside class="col-md-4 content__right">
                <div class="row">
                    <div class="col-sm-6 col-md-12">
                        <div class="user_badge">
                            <div class="user_badge__img"><img src="~/images/avatar.svg" alt=""></div>
                            <div class="user_badge__info">
                                <div class="user_badge__title">@Model.AuthorFullName</div>
                                <div class="user_badge__desc">Creator</div>
                            </div>
                        </div>
                        @await Html.PartialAsync("ProjectDetailsStatusPartial", new ProjectDetailsStatusViewModel
                   {
                       ProjectId = Model.Id,
                       Status = Model.Status,
                       VotesFor = Model.VotesFor,
                       VotesAgainst = Model.VotesAgainst,
                       CompetitionRegistrationDeadline = Model.CompetitionRegistrationDeadline,
                       ImplementationDeadline = Model.ImplementationDeadline,
                       VotingDeadline = Model.VotingDeadline,
                       IsParticipant = Model.IsParticipant,
                       HasResult = Model.ParticipantsPartial.HasResult
                   })
                        @*<div class="btn-group" role="group">
                                <button type="button" class="btn btn-default"><i class="icon icon--finance"><span class="path1"></span><span class="path2"></span><span class="path3"></span></i>Finance</button>
                                @if (!Model.IsFollowing)
                                {
                                    <a asp-area="" asp-controller="ProjectDetails" asp-action="FollowProject" asp-route-id="@Model.Id" id="followButton" class="btn btn-default">
                                        <i class="icon icon--follow"></i>Follow
                                    </a>
                                }
                                else
                                {
                                    <a asp-area="" asp-controller="ProjectDetails" asp-action="UnFollowProject" asp-route-id="@Model.Id" id="followButton" class="btn btn-default">
                                        Unfollow
                                    </a>
                                }
                                <button type="button" class="btn btn-default"><i class="icon--more"></i></button>
                            </div>*@
                    </div>

                    <div class="col-sm-5 col-sm-offset-1 col-md-offset-0 col-md-12">

                        <ul class="list list--info">
                            <li class="list__item">
                                <div class="list__icon">
                                    <span class="check @checkCompetition"></span>
                                </div>
                                <div class="list__content">
                                    <div class="title @textCompetition">Registration</div>
                                    <p>@Model.Created.ToString("MMM d") - @Model.CompetitionRegistrationDeadline.ToString("MMM d")</p>
                                </div>
                            </li>
                            <li class="list__item _current">
                                <div class="list__icon">
                                    <span class="check @checkSubmission"></span>
                                </div>
                                <div class="list__content">
                                    <div class="title @textSubmission">Submissions</div>
                                    <p>@Model.CompetitionRegistrationDeadline.ToString("MMM d") - @Model.ImplementationDeadline.ToString("MMM d")</p>
                                </div>
                            </li>
                            <li class="list__item">
                                <div class="list__icon">
                                    <span class="check @checkVoting"></span>
                                </div>
                                <div class="list__content">
                                    <div class="title @textVoting">Voting</div>
                                    <p>@Model.ImplementationDeadline.ToString("MMM d") - @Model.VotingDeadline.ToString("MMM d")</p>
                                </div>
                            </li>
                        </ul>

                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6 col-md-12">
                        <h5 class="border-bottom">Tags</h5>

                        <div class="tags_list">
                            <div class="tag_item"><a href="">@Model.Category</a></div>
                            @if (Model.TagsList != null)
                            {
                                foreach (var category in Model.TagsList)
                                {
                                    <div class="tag_item"><a href="">@category</a></div>
                                }
                            }
                        </div>
                    </div>
                    @if (!string.IsNullOrEmpty(Model.ProgrammingResourceName) && !string.IsNullOrEmpty(Model.ProgrammingResourceLink))
                    {
                        <div class="col-sm-5 col-sm-offset-1 col-md-offset-0 col-md-12">
                            <h5 class="border-bottom">Programming resources</h5>

                            <ul class="list list--text_previews">
                                <li class="list__item">
                                    <a href="@Model.ProgrammingResourceLink">
                                        <div class="list__icon">
                                            <i class="icon icon--github"></i>
                                        </div>
                                        <div class="list__content">
                                            <span class="text-muted">@Model.ProgrammingResourceName</span>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    }

                    @*<div class="col-sm-5 col-sm-offset-1 col-md-offset-0 col-md-12">
                            <h5 class="border-bottom">Share</h5>

                            <div class="sharing">
                                <a class="sharing__link sharing__link--fb" href="https://www.facebook.com/groups/542506412568917/"><i class="icon icon--facebook_icn"><span class="path1"></span><span class="path2"></span></i></a>
                                <a class="sharing__link sharing__link--tw" href="https://twitter.com/LykkeCity"><i class="icon icon--twitter_icn"><span class="path1"></span><span class="path2"></span></i></a>
                            </div>
                        </div>*@
                </div>

                <h5 class="border-bottom">Project stream</h5>

                <ul class="list list--text_previews">
                    @foreach (var project in Model.OtherProjects)
                    {
                        <li class="list__item">
                            <a class="other-projects-name" asp-controller="Project" asp-action="ProjectDetails" asp-route-id="@project.Id">
                                <p><b>@project.Name</b></p>
                                <span class="text-muted">$@project.BudgetFirstPlace &middot; @project.Members members</span>
                            </a>
                        </li>
                    }
                </ul>
            </aside>
        </div>
    </div>
</section>

@if (ViewBag.ParticipantAdded != null && ViewBag.ParticipantAdded == true)
{
    <script src="~/js/vendor/jquery-1.11.2.min.js"></script>
    <script src="~/js/vendor/bootstrap.min.js"></script>
    <script>
        $(window).load(function () {
            $('#modal_success').modal('show');
        });
    </script>
}